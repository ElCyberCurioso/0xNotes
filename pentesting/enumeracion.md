# Enumeración

## ¿Qué es la enumeración?

La enumeración es la fase donde interactuamos activamente con el objetivo para descubrir servicios, puertos abiertos, usuarios, y posibles vectores de ataque.

## Escaneo de Puertos

### Nmap

#### Escaneos básicos
```bash
# Escaneo básico
nmap 192.168.1.1

# Escaneo de todos los puertos
nmap -p- 192.168.1.1

# Escaneo de puertos específicos
nmap -p 80,443,8080 192.168.1.1

# Escaneo rápido (top 100 puertos)
nmap -F 192.168.1.1
```

#### Escaneos avanzados
```bash
# Escaneo SYN (stealthy)
nmap -sS 192.168.1.1

# Detección de servicios y versiones
nmap -sV 192.168.1.1

# Detección de sistema operativo
nmap -O 192.168.1.1

# Escaneo agresivo (OS, versión, scripts, traceroute)
nmap -A 192.168.1.1

# Escaneo completo con scripts NSE
nmap -sC -sV -p- 192.168.1.1

# Escaneo de vulnerabilidades
nmap --script vuln 192.168.1.1
```

#### Evasión de firewalls
```bash
# Fragmentación de paquetes
nmap -f 192.168.1.1

# Especificar MTU personalizado
nmap --mtu 24 192.168.1.1

# Usar decoys (IPs falsas)
nmap -D RND:10 192.168.1.1

# Spoofing de IP origen
nmap -S <IP_FALSA> 192.168.1.1

# Ajustar timing (T0=paranoid, T5=insane)
nmap -T2 192.168.1.1
```

#### Scripts NSE útiles
```bash
# SMB enumeration
nmap --script smb-enum-shares,smb-enum-users -p 445 192.168.1.1

# HTTP enumeration
nmap --script http-enum -p 80 192.168.1.1

# SSL/TLS vulnerabilities
nmap --script ssl-heartbleed,ssl-poodle -p 443 192.168.1.1

# DNS enumeration
nmap --script dns-brute ejemplo.com
```

## Enumeración de Servicios

### FTP (Puerto 21)
```bash
# Conectar con FTP
ftp 192.168.1.1

# Login anónimo
Usuario: anonymous
Contraseña: anonymous

# Nmap scripts para FTP
nmap --script ftp-anon,ftp-bounce -p 21 192.168.1.1
```

### SSH (Puerto 22)
```bash
# Banner grabbing
nc 192.168.1.1 22

# Enumeración de algoritmos
nmap --script ssh2-enum-algos -p 22 192.168.1.1

# Intentar autenticación con usuarios comunes
hydra -L users.txt -P passwords.txt ssh://192.168.1.1
```

### SMB (Puertos 139, 445)
```bash
# Enum4linux
enum4linux -a 192.168.1.1

# SMBClient listar shares
smbclient -L //192.168.1.1 -N

# Conectar a un share
smbclient //192.168.1.1/share -U usuario

# SMBMap
smbmap -H 192.168.1.1
smbmap -H 192.168.1.1 -u usuario -p password

# CrackMapExec
crackmapexec smb 192.168.1.1 -u usuario -p password --shares
```

### HTTP/HTTPS (Puertos 80, 443)

#### Nikto
```bash
# Escaneo básico
nikto -h http://192.168.1.1

# Escaneo con autenticación
nikto -h http://192.168.1.1 -id usuario:password
```

#### Gobuster
```bash
# Directory busting
gobuster dir -u http://192.168.1.1 -w /usr/share/wordlists/dirb/common.txt

# Con extensiones específicas
gobuster dir -u http://192.168.1.1 -w wordlist.txt -x php,html,txt

# Virtual host discovery
gobuster vhost -u http://ejemplo.com -w subdomains.txt
```

#### Dirb
```bash
dirb http://192.168.1.1 /usr/share/wordlists/dirb/common.txt
```

#### FFuf
```bash
# Directory fuzzing
ffuf -u http://192.168.1.1/FUZZ -w wordlist.txt

# Subdomain fuzzing
ffuf -u http://FUZZ.ejemplo.com -w subdomains.txt

# Parameter fuzzing
ffuf -u http://192.168.1.1/page?FUZZ=value -w params.txt
```

#### WPScan (WordPress)
```bash
# Escaneo básico
wpscan --url http://ejemplo.com

# Enumerar usuarios
wpscan --url http://ejemplo.com --enumerate u

# Enumerar plugins vulnerables
wpscan --url http://ejemplo.com --enumerate vp

# Brute force
wpscan --url http://ejemplo.com --passwords passwords.txt --usernames admin
```

### SQL (Puerto 3306, 1433, 5432)
```bash
# MySQL
mysql -h 192.168.1.1 -u root -p

# MSSQL (con impacket)
mssqlclient.py usuario:password@192.168.1.1

# PostgreSQL
psql -h 192.168.1.1 -U postgres
```

### RDP (Puerto 3389)
```bash
# Escaneo con Nmap
nmap --script rdp-enum-encryption -p 3389 192.168.1.1

# Conectar con rdesktop
rdesktop 192.168.1.1

# Conectar con xfreerdp
xfreerdp /u:usuario /p:password /v:192.168.1.1
```

### SNMP (Puerto 161)
```bash
# snmpwalk
snmpwalk -v 2c -c public 192.168.1.1

# Enumeración con onesixtyone
onesixtyone -c community.txt 192.168.1.1

# snmp-check
snmp-check 192.168.1.1
```

## Enumeración de Usuarios

### Windows
```bash
# Enum4linux
enum4linux -U 192.168.1.1

# RPCClient
rpcclient -U "" -N 192.168.1.1
enumdomusers
queryuser 0x450

# Impacket lookupsid
lookupsid.py usuario:password@192.168.1.1
```

### Linux
```bash
# Enum4linux
enum4linux -U 192.168.1.1

# Finger (si está disponible)
finger @192.168.1.1
```

## Enumeración de DNS

```bash
# Transferencia de zona
dig axfr @ns1.ejemplo.com ejemplo.com
host -l ejemplo.com ns1.ejemplo.com

# Enumeración con DNSenum
dnsenum ejemplo.com

# Fierce
fierce --domain ejemplo.com
```

## Enumeración Web Avanzada

### Identificar WAF
```bash
# wafw00f
wafw00f http://ejemplo.com

# Nmap
nmap --script http-waf-detect,http-waf-fingerprint ejemplo.com
```

### Análisis de robots.txt y sitemap.xml
```bash
curl http://ejemplo.com/robots.txt
curl http://ejemplo.com/sitemap.xml
```

### Búsqueda de archivos de backup
```bash
# Posibles nombres
.bak
.old
.txt
.zip
~
.swp

# Ejemplo
http://ejemplo.com/config.php.bak
http://ejemplo.com/admin.old
```

## Automatización

### AutoRecon
```bash
autorecon 192.168.1.1
autorecon -t targets.txt
```

### Reconnoitre
```bash
reconnoitre -t 192.168.1.0/24 -o resultados
```

### Nmap Automator
```bash
nmapAutomator.sh 192.168.1.1 All
```

## Checklist de Enumeración

- [ ] Escaneo de puertos completo
- [ ] Identificación de servicios y versiones
- [ ] Detección de sistema operativo
- [ ] Enumeración de shares SMB
- [ ] Enumeración de usuarios
- [ ] Directory busting en servicios web
- [ ] Identificación de tecnologías web
- [ ] Búsqueda de archivos sensibles
- [ ] Enumeración de subdominios
- [ ] Análisis de certificados SSL
- [ ] Verificación de configuraciones por defecto
- [ ] Búsqueda de CVEs conocidos

## Notas Importantes

> [!TIP]
> No te limites a los puertos comunes. Un escaneo completo de todos los puertos (65535) puede revelar servicios en puertos no estándar.

> [!WARNING]
> Los escaneos agresivos pueden:
> - Generar muchos logs
> - Activar sistemas IDS/IPS
> - Causar problemas de rendimiento en el objetivo
> 
> Ajusta tus técnicas según el alcance del engagement.

## Herramientas Recomendadas

| Herramienta | Uso Principal |
|-------------|---------------|
| Nmap | Escaneo de puertos y servicios |
| Gobuster | Directory/file brute forcing |
| Enum4linux | Enumeración SMB/Windows |
| WPScan | Enumeración WordPress |
| Nikto | Escaneo de vulnerabilidades web |
| FFuf | Fuzzing rápido |
| CrackMapExec | Post-explotación Windows |

## Referencias

- [Nmap Reference Guide](https://nmap.org/book/man.html)
- [GTFOBins](https://gtfobins.github.io/)
- [HackTricks](https://book.hacktricks.xyz/)
